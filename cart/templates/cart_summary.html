{% extends 'bace.html' %}
{% load static %}
{% load humanize %}
{% block content %}
        <!-- Header-->
        <header class="bg-dark py-5">
            <div class="container px-4 px-lg-5 my-5">
                <div class="text-center text-white">
                    <h1 class="display-4 fw-bolder">Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø´Ù…Ø§</h1>
                    <p class="lead fw-normal text-white-50 mb-0">Ø§ÛŒÙ†Ø¬Ø§ Ù‡Ø± Ú†ÛŒ Ú©Ù‡ Ø¨Ø®ÙˆØ§ÛŒ Ø¨Ø®Ø±ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒØ´Ù‡ </p>
                </div>
            </div>
        </header>
    <br><br>
    {% if cart_products %}
    {% for product in cart_products %}
      <div class="container">
    <div class="card mb-3">
  <div class="row g-0">
    <div class="col-md-4">
      <img src="{{ product.picture.url }}" class="img-fluid rounded-start" alt="...">
    </div>
    <div class="col-md-8">
      <div class="card-body">
        <h5 class="card-title">{{ product.name }}</h5>
        <p class="card-text">{{ product.discription }}</p>
          {% if product.is_sale %}
        <p class="card-text">  Ù‚ÛŒÙ…ØªğŸ’°: <strike> {{ product.price| intcomma}} </strike>  -  {{ product.sale_price | intcomma }}</p>
              {% else %}
              <p class="card-text"> Ù‚ÛŒÙ…ØªğŸ’°: {{ product.price| intcomma}}</p>
        {% endif %}
      <p class="card-text">  ØªØ¹Ø¯Ø§Ø¯:</p>
       <select class="form-select" id="select{{ product.id }}" >
           {% for key,value in quantities.items %}
           {% if key == product.id|slugify %}
               <option selected> {{ value }}</option>
            {% endif %}
            {% endfor %}
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
        <option value="6">6</option>
        </select>
        <br>
      <button type="button" data-index="{{ product.id }}"
              class="btn btn-primary update-cart">ÙˆÛŒØ±Ø§ÛŒØ´</button>
      <a href="{% url 'home' %}" class="btn btn-secondary">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ</a>
      </div>
    </div>
  </div>
</div>

    </div>
    <br><br>
    <script>
    $(document).on('click', '#add-cart',function(e){
        e.preventDefault();
        $.ajax({
            type: 'POST',
            url:'{% url 'cart_add' %}',
            data: {
                product_id: $('#add-cart').val(),
                csrfmiddlewaretoken: '{{ csrf_token }}',
                action: 'post'
            },
            success:function (json){
                //console.log(json)
                document.getElementById('cart_quantity').textContent = json.qty
            },
            error: function (xhr, errmsg, err) {

            }
        })
    })
    </script>
    {% endfor %}
    {% else %}
    <center><h3 class="container">&#128531Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø´Ù…Ø§ Ø®Ø§Ù„ÛŒ Ù…ÛŒØ¨Ø§Ø´Ø¯.</h3></center>
    {% endif %}
    <br>
        <script>
    $(document).on('click', '.update-cart',function(e){
        e.preventDefault();
        var productid = $(this).data('index')
        $.ajax({
            type: 'POST',
            url:'{% url 'cart_update' %}',
            data: {
                product_id: $(this).data('index'),
                product_qty: $('#select'+productid+' option:selected').text(),
                csrfmiddlewaretoken: '{{ csrf_token }}',
                action: 'post'
            },
            success:function (json){
                //console.log(json)
                //document.getElementById('cart_quantity').textContent = json.qty
                location.reload();
            },
            error: function (xhr, errmsg, err) {

            }
        })
    })
    </script>
{% endblock %}
        
